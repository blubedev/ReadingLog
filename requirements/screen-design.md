# 画面設計書

## 1. 概要

このドキュメントは、読書管理アプリケーションの画面設計を定義します。
要件定義書（`requirements.md`）に基づいて、必要な画面と各画面の機能を詳細に記述します。

---

## 2. 画面一覧

### 2.1 認証関連画面

| 画面ID | 画面名 | パス | 認証要否 |
|--------|--------|------|----------|
| AUTH-01 | ログイン画面 | `/login` | 不要 |
| AUTH-02 | ユーザー登録画面 | `/register` | 不要 |

### 2.2 本の管理関連画面

| 画面ID | 画面名 | パス | 認証要否 |
|--------|--------|------|----------|
| BOOK-01 | 本の一覧画面 | `/books` | 必須 |
| BOOK-02 | 本の登録画面 | `/books/new` | 必須 |
| BOOK-03 | 本の詳細画面 | `/books/:id` | 必須 |
| BOOK-04 | 本の編集画面 | `/books/:id/edit` | 必須 |

### 2.3 進捗管理関連画面

| 画面ID | 画面名 | パス | 認証要否 |
|--------|--------|------|----------|
| PROG-01 | 進捗記録画面 | `/books/:id/progress` | 必須 |

### 2.4 メモ・感想関連画面

| 画面ID | 画面名 | パス | 認証要否 |
|--------|--------|------|----------|
| NOTE-01 | メモ追加・編集画面 | `/books/:id/notes/new` または `/books/:id/notes/:noteId/edit` | 必須 |

---

## 3. 画面詳細設計

### 3.1 認証関連画面

#### AUTH-01: ログイン画面

**画面パス**: `/login`

**機能概要**:
ユーザーがアプリケーションにログインするための画面です。

**画面要素**:
- **タイトル**: 「ログイン」または「読書管理アプリにログイン」
- **メールアドレス入力欄**（必須）
  - プレースホルダー: 「メールアドレスを入力」
  - バリデーション: メールアドレス形式の検証
- **パスワード入力欄**（必須）
  - プレースホルダー: 「パスワードを入力」
  - タイプ: `password`（入力内容を非表示）
- **ログインボタン**
  - メールアドレスとパスワードが入力されている場合のみ有効
- **ユーザー登録へのリンク**
  - 「アカウントをお持ちでない方はこちら」などのテキスト
  - `/register`へのリンク
- **エラーメッセージ表示エリア**
  - ログイン失敗時にエラーメッセージを表示

**動作**:
1. ユーザーがメールアドレスとパスワードを入力
2. 「ログイン」ボタンをクリック
3. バックエンドAPI（`POST /api/auth/login`）にリクエスト送信
4. 認証成功時: JWTトークンを保存し、`/books`（本の一覧画面）にリダイレクト
5. 認証失敗時: エラーメッセージを表示

**認証状態の維持**:
- JWTトークンを`HttpOnly Cookie`または`localStorage`に保存
- トークンの有効期限を管理
- リフレッシュトークンを使用する場合は、リフレッシュ処理を実装

**レスポンシブ対応**:
- モバイル端末でも使いやすいUI
- 入力欄のサイズを適切に調整

---

#### AUTH-02: ユーザー登録画面

**画面パス**: `/register`

**機能概要**:
新規ユーザーがアカウントを作成するための画面です。

**画面要素**:
- **タイトル**: 「ユーザー登録」または「新規アカウント作成」
- **ユーザー名入力欄**（必須）
  - プレースホルダー: 「ユーザー名を入力」
  - バリデーション: 文字数制限、使用可能文字の制限
- **メールアドレス入力欄**（必須）
  - プレースホルダー: 「メールアドレスを入力」
  - バリデーション: メールアドレス形式の検証、重複チェック
- **パスワード入力欄**（必須）
  - プレースホルダー: 「パスワードを入力」
  - タイプ: `password`
  - バリデーション: 最小文字数、強度チェック（オプション）
- **パスワード確認入力欄**（必須）
  - プレースホルダー: 「パスワードを再入力」
  - タイプ: `password`
  - バリデーション: パスワード入力欄と一致するか確認
- **登録ボタン**
  - すべての必須項目が入力され、バリデーションを通過した場合のみ有効
- **ログイン画面へのリンク**
  - 「既にアカウントをお持ちの方はこちら」などのテキスト
  - `/login`へのリンク
- **エラーメッセージ表示エリア**
  - バリデーションエラーや登録失敗時のエラーメッセージを表示

**動作**:
1. ユーザーが各項目を入力
2. リアルタイムでバリデーションを実行
3. 「登録」ボタンをクリック
4. バックエンドAPI（`POST /api/auth/register`）にリクエスト送信
5. 登録成功時: 自動的にログインし、`/books`（本の一覧画面）にリダイレクト
6. 登録失敗時: エラーメッセージを表示

**セキュリティ要件**:
- パスワードはクライアント側でハッシュ化しない（バックエンドでハッシュ化）
- メールアドレスの重複チェック
- XSS対策を実装

---

### 3.2 本の管理関連画面

#### BOOK-01: 本の一覧画面

**画面パス**: `/books`

**機能概要**:
ユーザーが登録した本の一覧を表示し、検索・フィルタ機能を提供する画面です。

**画面要素**:
- **ヘッダー**
  - アプリケーション名またはロゴ
  - ユーザー名表示（オプション）
  - ログアウトボタン
- **検索・フィルタエリア**
  - **検索入力欄**
    - プレースホルダー: 「タイトル・著者名で検索」
    - リアルタイム検索対応（オプション）
  - **読書状況フィルタ**
    - ラジオボタンまたはドロップダウン
    - 選択肢: 「すべて」「未読」「読書中」「読了」「中断」
  - **評価フィルタ**（オプション）
    - ドロップダウン
    - 選択肢: 「すべて」「3以上」「4以上」「5のみ」
  - **フィルタリセットボタン**
- **本の一覧表示エリア**
  - **カード形式またはリスト形式で表示**
    - 各本のカードに表示する情報:
      - カバー画像（存在する場合）
      - タイトル
      - 著者名
      - 読書状況（バッジ表示）
      - 進捗率（プログレスバー、読書中の本のみ）
      - 評価（星表示、評価がある場合のみ）
      - 登録日時
  - **ページネーション**（任意）
    - 本の数が多い場合、ページ分割して表示
- **本の登録ボタン**
  - 固定位置（フローティングアクションボタンなど）
  - `/books/new`へのリンク
- **空状態表示**
  - 本が登録されていない場合のメッセージ
  - 「本を登録する」ボタン

**動作**:
1. 画面表示時に、バックエンドAPI（`GET /api/books`）から本の一覧を取得
2. 検索・フィルタ条件を変更すると、APIにクエリパラメータを付与して再取得
3. 本のカードをクリックすると、`/books/:id`（本の詳細画面）に遷移
4. 本の登録ボタンをクリックすると、`/books/new`（本の登録画面）に遷移

**検索・フィルタ機能**:
- タイトル・著者名での検索: `GET /api/books?search=キーワード`
- 読書状況でのフィルタ: `GET /api/books?status=読書中`
- 評価でのフィルタ: `GET /api/books?rating=4`
- 複数条件の組み合わせ: `GET /api/books?search=キーワード&status=読書中&rating=4`

**パフォーマンス要件**:
- 一覧表示のレスポンス時間: 1秒以内
- 無限スクロールまたはページネーションで大量データに対応

**レスポンシブ対応**:
- モバイル: 1列表示
- タブレット: 2列表示
- デスクトップ: 3-4列表示

---

#### BOOK-02: 本の登録画面

**画面パス**: `/books/new`

**機能概要**:
新しい本を登録するための画面です。バーコード読み取りまたは手動入力で書籍情報を取得します。

**画面要素**:
- **ヘッダー**
  - 「本を登録」タイトル
  - 戻るボタン（`/books`に戻る）
- **登録方法選択タブ**
  - **バーコード読み取りタブ**（推奨）
  - **手動入力タブ**
- **バーコード読み取りエリア**（バーコード読み取りタブ選択時）
  - **カメラプレビュー**
    - カメラアクセスの許可を要求
    - リアルタイムでバーコードをスキャン
    - 読み取り成功時に自動で書籍情報を検索
  - **読み取りガイド**
    - 「バーコードをカメラの中央に合わせてください」などのメッセージ
  - **手動入力に切り替えボタン**
    - 読み取りに失敗した場合や、手動入力に切り替えたい場合
- **手動入力エリア**（手動入力タブ選択時、またはバーコード読み取り失敗時）
  - **タイトル入力欄**（必須、ISBN入力時は任意）
    - プレースホルダー: 「タイトルを入力」
  - **ISBN入力欄**（必須、タイトル入力時は任意）
    - プレースホルダー: 「ISBNを入力」
    - バリデーション: ISBN形式の検証
  - **検索ボタン**
    - タイトルまたはISBNを入力して、Open Library APIから書籍情報を検索
- **書籍情報表示・確認エリア**（APIから情報取得後）
  - **書籍情報カード**
    - カバー画像
    - タイトル
    - 著者名
    - ISBN
    - 出版社
    - 出版日
    - 総ページ数
    - 説明文
  - **編集ボタン**
    - 取得した情報を編集可能にする
  - **候補選択**（複数の候補がある場合）
    - 候補一覧を表示
    - ユーザーが選択可能
- **書籍情報編集フォーム**（編集ボタンクリック時、またはAPIから情報が取得できない場合）
  - タイトル（必須）
  - 著者名（任意）
  - ISBN（任意）
  - 出版社（任意）
  - 出版日（任意）
  - 総ページ数（任意）
  - 説明文（任意）
- **登録ボタン**
  - 必須項目が入力されている場合のみ有効
- **キャンセルボタン**
  - `/books`に戻る

**動作**:
1. **バーコード読み取りの場合**:
   - カメラアクセスの許可を要求
   - バーコードをスキャン
   - ISBNを取得したら、自動でOpen Library APIから書籍情報を検索
   - 書籍情報を表示し、ユーザーが確認・編集
   - 「登録」ボタンで登録

2. **手動入力の場合**:
   - タイトルまたはISBNを入力
   - 「検索」ボタンでOpen Library APIから書籍情報を検索
   - 書籍情報を表示し、ユーザーが確認・編集
   - APIから情報が取得できない場合は、手動入力フォームを表示
   - 「登録」ボタンで登録

3. **登録処理**:
   - バックエンドAPI（`POST /api/books`）にリクエスト送信
   - 登録成功時: `/books/:id`（本の詳細画面）にリダイレクト
   - 登録失敗時: エラーメッセージを表示

**使用する外部API**:
- Open Library API: 書籍情報の取得
- html5-qrcode: バーコード読み取り

**エラーハンドリング**:
- カメラアクセス拒否時: 手動入力に切り替えを促す
- バーコード読み取り失敗時: 再試行または手動入力に切り替え
- APIから情報が取得できない場合: 手動入力フォームを表示

---

#### BOOK-03: 本の詳細画面

**画面パス**: `/books/:id`

**機能概要**:
1冊の本の詳細情報を表示し、進捗管理、メモ追加、評価などの操作を行う画面です。

**画面要素**:
- **ヘッダー**
  - 戻るボタン（`/books`に戻る）
  - 編集ボタン（`/books/:id/edit`に遷移）
  - 削除ボタン（確認ダイアログ付き）
- **基本情報セクション**
  - カバー画像（存在する場合）
  - タイトル
  - 著者名
  - ISBN
  - 出版社
  - 出版日
  - 総ページ数
  - 説明文
- **読書状況セクション**
  - 現在の読書状況（バッジ表示）
    - 「未読」「読書中」「読了」「中断」
  - 状況変更ボタン
    - ドロップダウンまたはモーダルで状況を選択
- **進捗情報セクション**（読書中の本の場合）
  - **現在のページ数表示**
  - **進捗率表示**
    - プログレスバー
    - パーセンテージ表示（例: 「150 / 300ページ (50%)」）
  - **進捗更新ボタン**
    - `/books/:id/progress`（進捗記録画面）に遷移
- **評価セクション**
  - **星評価表示**（評価がある場合）
    - 1〜5段階、0.5刻み
  - **評価コメント**（評価がある場合）
  - **評価ボタン**（評価がない場合、または評価を変更したい場合）
    - モーダルまたはインラインで評価入力
- **読了日セクション**（読了した本の場合）
  - 読了日表示
- **メモ・感想セクション**
  - **メモ一覧表示**
    - 各メモの内容
    - 作成日時・更新日時
    - 編集ボタン
    - 削除ボタン
  - **メモ追加ボタン**
    - `/books/:id/notes/new`に遷移、またはインラインで追加
- **進捗履歴セクション**（任意）
  - 進捗履歴のグラフ表示
  - 日付ごとのページ数の推移

**動作**:
1. 画面表示時に、バックエンドAPI（`GET /api/books/:id`）から本の詳細情報を取得
2. メモ一覧を取得（`GET /api/books/:id/notes`）
3. 進捗履歴を取得（`GET /api/books/:id/progress-history`、任意）
4. 各操作ボタンで対応する画面に遷移、またはモーダルを表示

**削除機能**:
- 削除ボタンクリック時、確認ダイアログを表示
- 確認後、バックエンドAPI（`DELETE /api/books/:id`）にリクエスト送信
- 削除成功時: `/books`（本の一覧画面）にリダイレクト

**レスポンシブ対応**:
- モバイル: 縦スクロールで情報を表示
- デスクトップ: 2カラムレイアウトなどで情報を整理

---

#### BOOK-04: 本の編集画面

**画面パス**: `/books/:id/edit`

**機能概要**:
登録済みの本の情報を編集するための画面です。

**画面要素**:
- **ヘッダー**
  - 「本を編集」タイトル
  - 戻るボタン（`/books/:id`に戻る）
- **編集フォーム**
  - タイトル（必須）
  - 著者名（任意）
  - ISBN（任意）
  - 出版社（任意）
  - 出版日（任意）
  - 総ページ数（任意）
  - 説明文（任意）
  - カバー画像URL（任意）
- **保存ボタン**
  - バリデーションを通過した場合のみ有効
- **キャンセルボタン**
  - `/books/:id`に戻る

**動作**:
1. 画面表示時に、バックエンドAPI（`GET /api/books/:id`）から現在の情報を取得
2. フォームに情報を表示
3. ユーザーが情報を編集
4. 「保存」ボタンクリック時、バックエンドAPI（`PUT /api/books/:id`）にリクエスト送信
5. 更新成功時: `/books/:id`（本の詳細画面）にリダイレクト
6. 更新失敗時: エラーメッセージを表示

**バリデーション**:
- タイトルは必須
- その他の項目は任意

---

### 3.3 進捗管理関連画面

#### PROG-01: 進捗記録画面

**画面パス**: `/books/:id/progress`

**機能概要**:
読書の進捗（ページ数）を記録するための画面です。カメラでページ数を自動認識する機能と手動入力機能を提供します。

**画面要素**:
- **ヘッダー**
  - 「進捗を記録」タイトル
  - 戻るボタン（`/books/:id`に戻る）
- **現在の進捗表示**
  - 現在のページ数
  - 進捗率（プログレスバーとパーセンテージ）
  - 総ページ数
- **入力方法選択タブ**
  - **カメラで自動認識タブ**（推奨）
  - **手動入力タブ**
- **カメラ自動認識エリア**（カメラで自動認識タブ選択時）
  - **カメラプレビュー**
    - カメラアクセスの許可を要求
    - 本のページ番号部分を撮影
  - **撮影ガイド**
    - 「ページ番号をカメラの中央に合わせてください」などのメッセージ
  - **撮影ボタン**
    - ページ番号を撮影
  - **OCR処理中表示**
    - 「認識中...」などのメッセージ
  - **認識結果表示**
    - 認識したページ数を表示
    - ユーザーが確認・修正可能
  - **再撮影ボタン**
    - 認識に失敗した場合や、再撮影したい場合
  - **手動入力に切り替えボタン**
- **手動入力エリア**（手動入力タブ選択時、またはOCR認識失敗時）
  - **ページ数入力欄**（必須）
    - プレースホルダー: 「ページ数を入力」
    - タイプ: `number`
    - バリデーション: 0以上、総ページ数以下
  - **進捗率の自動計算表示**
    - 総ページ数がある場合、自動で進捗率を計算して表示
- **保存ボタン**
  - ページ数が入力されている場合のみ有効
- **キャンセルボタン**
  - `/books/:id`に戻る

**動作**:
1. **カメラ自動認識の場合**:
   - カメラアクセスの許可を要求
   - ページ番号を撮影
   - Tesseract.jsでOCR処理を実行
   - 認識したページ数を表示
   - ユーザーが確認・修正
   - 「保存」ボタンで進捗を更新

2. **手動入力の場合**:
   - ページ数を数値で直接入力
   - 進捗率を自動計算（総ページ数がある場合）
   - 「保存」ボタンで進捗を更新

3. **保存処理**:
   - バックエンドAPI（`PUT /api/books/:id/progress`）にリクエスト送信
   - 進捗履歴も記録（任意）
   - 更新成功時: `/books/:id`（本の詳細画面）にリダイレクト
   - 更新失敗時: エラーメッセージを表示

**使用するライブラリ**:
- Tesseract.js: OCR処理

**エラーハンドリング**:
- カメラアクセス拒否時: 手動入力に切り替えを促す
- OCR認識失敗時: 再撮影または手動入力に切り替え
- 認識結果が不正な場合: ユーザーが修正可能

**進捗率の計算**:
- 総ページ数がある場合: `進捗率 = (現在のページ数 / 総ページ数) × 100`
- 総ページ数がない場合: 進捗率は表示しない

---

### 3.4 メモ・感想関連画面

#### NOTE-01: メモ追加・編集画面

**画面パス**: 
- 新規追加: `/books/:id/notes/new`
- 編集: `/books/:id/notes/:noteId/edit`

**機能概要**:
本に関するメモや感想を追加・編集するための画面です。

**画面要素**:
- **ヘッダー**
  - 「メモを追加」または「メモを編集」タイトル
  - 戻るボタン（`/books/:id`に戻る）
- **メモ入力エリア**
  - **メモ本文入力欄**（必須）
    - 複数行テキストエリア
    - プレースホルダー: 「メモや感想を入力してください」
    - 文字数カウント（オプション）
- **保存ボタン**
  - メモ本文が入力されている場合のみ有効
- **キャンセルボタン**
  - `/books/:id`に戻る
- **削除ボタン**（編集時のみ）
  - 確認ダイアログ付き
  - 削除後、`/books/:id`に戻る

**動作**:
1. **新規追加の場合**:
   - メモ本文を入力
   - 「保存」ボタンクリック時、バックエンドAPI（`POST /api/books/:id/notes`）にリクエスト送信
   - 追加成功時: `/books/:id`（本の詳細画面）にリダイレクト

2. **編集の場合**:
   - 画面表示時に、バックエンドAPI（`GET /api/notes/:noteId`）から現在のメモを取得
   - フォームに情報を表示
   - メモ本文を編集
   - 「保存」ボタンクリック時、バックエンドAPI（`PUT /api/notes/:noteId`）にリクエスト送信
   - 更新成功時: `/books/:id`（本の詳細画面）にリダイレクト

3. **削除の場合**:
   - 「削除」ボタンクリック時、確認ダイアログを表示
   - 確認後、バックエンドAPI（`DELETE /api/notes/:noteId`）にリクエスト送信
   - 削除成功時: `/books/:id`（本の詳細画面）にリダイレクト

**バリデーション**:
- メモ本文は必須
- 文字数制限（オプション）

**代替実装**:
- 本の詳細画面にインラインでメモ追加・編集機能を実装することも可能
- その場合、この画面は不要

---

## 4. 画面遷移図

```
[ログイン画面] ──→ [ユーザー登録画面]
     │                    │
     │                    │
     └──→ [本の一覧画面] ←──┘
              │
              ├──→ [本の登録画面] ──→ [本の詳細画面]
              │
              └──→ [本の詳細画面]
                        │
                        ├──→ [本の編集画面]
                        │
                        ├──→ [進捗記録画面]
                        │
                        └──→ [メモ追加・編集画面]
```

**認証フロー**:
- 未認証ユーザーは、`/login`または`/register`にリダイレクト
- 認証済みユーザーは、`/books`（本の一覧画面）から開始

---

## 5. 共通UIコンポーネント

### 5.1 ヘッダーコンポーネント
- アプリケーション名またはロゴ
- ナビゲーションメニュー（オプション）
- ユーザー情報表示
- ログアウトボタン

### 5.2 フッターコンポーネント（オプション）
- コピーライト表示
- リンク集（オプション）

### 5.3 ローディングコンポーネント
- APIリクエスト中のローディング表示
- スケルトンローディング（オプション）

### 5.4 エラーメッセージコンポーネント
- エラーメッセージの統一的な表示
- エラータイプに応じたアイコン表示

### 5.5 確認ダイアログコンポーネント
- 削除確認などで使用
- モーダルまたはアラート形式

### 5.6 バッジコンポーネント
- 読書状況の表示
- 色分け（未読: グレー、読書中: ブルー、読了: グリーン、中断: レッド）

### 5.7 プログレスバーコンポーネント
- 進捗率の可視化
- アニメーション効果（オプション）

### 5.8 星評価コンポーネント
- 評価の表示・入力
- 0.5刻みの評価に対応

---

## 6. レスポンシブデザイン

### 6.1 ブレークポイント
- **モバイル**: 〜640px
- **タブレット**: 641px〜1024px
- **デスクトップ**: 1025px〜

### 6.2 モバイル対応
- タッチ操作に最適化
- フローティングアクションボタンの使用
- ハンバーガーメニュー（オプション）
- カメラ機能の適切な動作確認

### 6.3 タブレット対応
- 2カラムレイアウトの活用
- タッチとマウス操作の両方に対応

### 6.4 デスクトップ対応
- 3-4カラムレイアウト
- ホバー効果の実装
- キーボードショートカット（オプション）

---

## 7. アクセシビリティ

### 7.1 基本的な要件
- 適切なHTMLセマンティクス
- ARIA属性の使用
- キーボード操作の対応
- スクリーンリーダー対応

### 7.2 カラーコントラスト
- WCAG 2.1 AAレベル以上のコントラスト比を確保
- 色だけで情報を伝えない

### 7.3 フォーカス管理
- フォーカス可能な要素に明確なフォーカス表示
- タブ順序の適切な設定

---

## 8. パフォーマンス要件

### 8.1 読み込み時間
- 初回読み込み: 3秒以内
- 画面遷移: 1秒以内
- APIレスポンス: 1秒以内

### 8.2 最適化
- 画像の遅延読み込み
- コード分割（Code Splitting）
- キャッシュの活用
- 無限スクロールまたはページネーション

---

## 9. セキュリティ要件

### 9.1 認証・認可
- 認証が必要な画面へのアクセス制御
- JWTトークンの適切な管理
- トークンの有効期限管理

### 9.2 入力値の検証
- クライアント側とサーバー側の両方でバリデーション
- XSS対策
- CSRF対策

### 9.3 エラーハンドリング
- 機密情報を含むエラーメッセージを表示しない
- 適切なエラーメッセージの表示

---

## 10. 実装優先順位

### Phase 1（最優先）
1. AUTH-01: ログイン画面
2. AUTH-02: ユーザー登録画面
3. BOOK-01: 本の一覧画面
4. BOOK-02: 本の登録画面（手動入力のみ）
5. BOOK-03: 本の詳細画面（基本情報のみ）

### Phase 2
6. BOOK-02: 本の登録画面（バーコード読み取り機能追加）
7. PROG-01: 進捗記録画面（手動入力のみ）
8. PROG-01: 進捗記録画面（OCR機能追加）

### Phase 3
9. NOTE-01: メモ追加・編集画面
10. BOOK-03: 本の詳細画面（メモ表示機能追加）

### Phase 4
11. BOOK-01: 本の一覧画面（検索・フィルタ機能追加）
12. BOOK-04: 本の編集画面
13. BOOK-03: 本の詳細画面（評価機能追加）

---

この画面設計書は、要件定義書に基づいて作成されています。実装時には、この設計書を参考にしながら、ユーザビリティとパフォーマンスを考慮した開発を行ってください。

