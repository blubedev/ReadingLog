# 読書管理アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
読書の進捗を管理し、読書記録を効率的に保存・閲覧できるWebアプリケーションを開発する。

### 1.2 対象ユーザー
- 読書習慣を身につけたい人
- 読んだ本を記録・管理したい人
- 読書の進捗を可視化したい人

---

## 2. 機能要件

### 2.1 本の登録機能
- **機能説明**: 読む本を登録する
- **入力方法**:
  1. **バーコード読み取り**（推奨）
     - カメラで本のバーコード（ISBN）を読み取る
     - ISBNを自動取得して書籍情報を検索
  2. **手動入力**
     - **タイトル**または**ISBN**のいずれか一方を入力（必須）
- **入力項目**（手動入力の場合）:
  - **タイトル**または**ISBN**のいずれか一方（必須）
  - ユーザーは最小限の情報のみを入力
- **自動取得項目**（WebAPIから取得）:
  - タイトル（ISBN入力時）
  - 著者名
  - ISBN（タイトル入力時、複数候補がある場合は選択可能）
  - 出版社
  - 出版日
  - 総ページ数
  - カバー画像URL
  - 説明文（任意）
- **自動記録項目**:
  - 登録日時
- **使用する外部API**:
  - **タイトル検索時**: Open Library API から書籍情報を自動取得
  - **ISBN検索時**（バーコード読み取り・ISBN手動入力）: 以下の順で検索
    1. **openBD API** で検索（日本の書籍情報に強い）
    2. 1で検索結果がなければ **Open Library API** で検索
  - 詳細なAPI選定理由や検討内容は `consideration/book-api-selection.md` を参照
- **バーコード読み取り機能**:
  - カメラアクセスの許可をユーザーに要求
  - リアルタイムでバーコードをスキャン
  - ISBN-10、ISBN-13の両方に対応
  - 読み取り成功時に自動で書籍情報を検索
  - 読み取り失敗時は再試行または手動入力に切り替え可能
- **詳細**:
  - 取得した情報はユーザーが確認・編集可能
  - 複数の候補がある場合は、ユーザーが選択できる
  - APIから情報が取得できない場合は、手動入力フォームを表示

### 2.2 読書状況管理機能
- **機能説明**: 本の読書状況を管理する
- **状態**:
  - 未読（未着手）
  - 読書中（現在読んでいる）
  - 読了（読み終わった）
  - 中断（途中でやめた）
- **詳細**:
  - 状態の変更が可能
  - 状態変更日時を記録

### 2.3 進捗記録機能
- **機能説明**: 読書の進捗を記録する
- **入力方法**:
  1. **カメラでページ数自動認識**（推奨）
     - カメラで本のページ番号を撮影
     - OCR（光学文字認識）でページ数を自動認識
     - 認識したページ数を自動入力
  2. **手動入力**
     - ページ数を数値で直接入力
- **詳細**:
  - 現在のページ数（読書中の本のみ）
  - 進捗率（%）（総ページ数がある場合、自動計算）
  - 進捗更新日時
  - 進捗履歴の記録（任意）
- **ページ数自動認識機能**:
  - カメラアクセスの許可をユーザーに要求
  - 本のページ番号部分を撮影
  - OCRでページ番号を認識
  - 認識結果をユーザーが確認・修正可能
  - 認識失敗時は再撮影または手動入力に切り替え可能

### 2.4 メモ・感想機能
- **機能説明**: 本に関するメモや感想を記録する
- **詳細**:
  - メモ本文（複数行テキスト）
  - 作成日時（自動記録）
  - 更新日時（自動記録）
  - 1冊の本に複数のメモを追加可能

### 2.5 評価機能
- **機能説明**: 読んだ本を評価する
- **詳細**:
  - 星評価（1〜5段階、0.5刻み）
  - 評価日時（自動記録）
  - 評価コメント（任意）

### 2.6 読了日記録機能
- **機能説明**: 本を読み終えた日を記録する
- **詳細**:
  - 読了日（日付選択）
  - 状態を「読了」に変更した際に自動記録（任意）

### 2.7 一覧表示機能
- **機能説明**: 登録した本の一覧を表示する
- **詳細**:
  - リスト形式で表示
  - 各本の基本情報（タイトル、著者、状態、進捗）を表示
  - ページネーション対応（任意）
- **バックエンド追加要件**（書籍一覧画面デザイン対応）:
  - **統計API** `GET /api/books/stats`: 読書統計を返すエンドポイント
    - レスポンス例: `{ totalBooks, readingCount, wantCount, finishedCount, totalPagesRead, averageProgress }`
    - 総冊数、読書中/読みたい(未読)/読了の件数、総読書ページ数、平均進捗率を集計して返す
  - **書籍一覧API** `GET /api/books` のクエリパラメータ拡張:
    - `sortBy`: ソート項目（`createdAt` / `updatedAt` / `title` など）
    - `sortOrder`: ソート順（`asc` / `desc`）

### 2.8 検索・フィルタ機能
- **機能説明**: 登録した本を検索・絞り込む
- **詳細**:
  - タイトル・著者名での検索
  - 読書状況でのフィルタ（未読/読書中/読了/中断）
  - 評価でのフィルタ（3以上、4以上など）
  - 複数条件の組み合わせ検索

### 2.9 詳細表示機能
- **機能説明**: 1冊の本の詳細情報を表示する
- **詳細**:
  - 基本情報の表示
  - 進捗情報の表示
  - メモ・感想の一覧表示
  - 評価の表示
  - 編集・削除機能へのリンク

### 2.10 編集・削除機能
- **機能説明**: 登録した本の情報を編集・削除する
- **詳細**:
  - 基本情報の編集
  - 本の削除（確認ダイアログ付き）

### 2.11 認証機能（必須）
- **機能説明**: 複数ユーザーに対応するための認証機能
- **詳細**:
  - ユーザー登録（サインアップ）
    - ユーザー名（必須）
    - メールアドレス（必須、一意）
    - パスワード（必須、ハッシュ化して保存）
  - ログイン（サインイン）
    - メールアドレスとパスワードで認証
    - セッション管理（JWT推奨）
  - ログアウト
  - パスワードリセット（任意、Phase 2以降）
  - 認証状態の維持（リフレッシュトークンなど）
- **セキュリティ要件**:
  - パスワードはbcryptなどでハッシュ化
  - JWTトークンの有効期限管理
  - 認証が必要なAPIエンドポイントの保護

### 2.12 ユーザ情報表示機能
- **機能説明**: ログイン中ユーザーの基本情報を確認できる画面を提供する
- **画面遷移**:
  - 書籍一覧画面のヘッダーに表示されている **ユーザー名** をクリックすると、ユーザ情報画面に遷移する
- **表示項目**:
  - ユーザー名
  - メールアドレス
  - 登録日（ユーザー登録日時）
  - 必要に応じて、今後の要件追加で項目を拡張可能とする

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 一覧表示のレスポンス時間: 1秒以内
- データベース操作の最適化

### 3.2 セキュリティ
- 入力値のバリデーション
- XSS対策
- NoSQLインジェクション対策（MongoDB使用時）
- 認証・認可の実装
- パスワードのハッシュ化（bcrypt推奨）
- HTTPS通信（本番環境）
- CORS設定の適切な管理

### 3.3 ユーザビリティ
- 直感的なUI/UX
- レスポンシブデザイン（モバイル対応）
- エラーメッセージの明確化

### 3.4 保守性
- コードの可読性
- 適切なコメント
- モジュール化

### 3.5 テスト
- **自動テスト**: 
  - Jest（ユニットテスト）
  - Jest + Supertest + MSW（結合テスト・統合テスト）
  - Selenium（E2Eテスト）
- **テストカバレッジ**: 70%以上を目標
- **CI/CD**: GitHub Actionsを使用して自動テストとデプロイを実現
- 詳細なテスト計画とCI/CDツールの選定理由は `consideration/cicd-tool-selection.md` を参照
- 結合テストツールの選定理由は `consideration/integration-test-tool-selection.md` を参照

---

## 4. 技術スタック

### 4.1 バックエンド
- Node.js + Express（既存）
- データベース: **MongoDB**（決定）
  - 詳細な選定理由や検討内容は `consideration/database-selection.md` を参照
- **MongoDB接続ライブラリ: Mongoose**（決定）
- 認証: **JWT（JSON Web Token）**（決定）
  - **選定方針**: インターネット公開を前提とした本番環境でのスケーラビリティ、インフラコスト、可用性を重視し、JWTを採用
  - **選定理由**: セキュリティ、実装、テスト工数、本番環境での運用を総合的に比較した結果、JWTが最適と判断
  - **詳細な比較・検討内容**: `consideration/auth-comparison.md` を参照

### 4.2 フロントエンド
- **Vue.js**（決定）
- Vue Router（ルーティング）
- **状態管理: Pinia**（決定）
- **UIフレームワーク: Tailwind CSS**（決定）
- **バーコード読み取りライブラリ**: **html5-qrcode**（決定）
  - カメラで本のバーコード（ISBN）を読み取る機能に使用
  - 詳細な選定理由や検討内容は `consideration/barcode-library-selection.md` を参照
- **OCRライブラリ**: **Tesseract.js**（決定）
  - カメラで本のページ番号を認識する機能に使用
  - 詳細な選定理由や検討内容は `consideration/ocr-library-selection.md` を参照

### 4.3 外部API
- **書籍情報取得API**（決定）
  - **ISBN検索時**（書籍登録機能 2.1）:
    1. **openBD API**（優先）: 日本の書籍情報を取得。ISBNで検索し、結果が得られない場合のみ次へ
    2. **Open Library API**（フォールバック）: openBDで見つからない場合に検索
  - **タイトル検索時**: **Open Library API** から書籍情報を自動取得
  - 詳細なAPI選定理由や検討内容は `consideration/book-api-selection.md` を参照

### 4.4 テスト・CI/CD
- **テストフレームワーク**: 
  - **Jest**（ユニットテスト）
  - **Jest + Supertest + MSW**（結合テスト・統合テスト、決定）
  - **Selenium**（E2Eテスト）
- **CI/CDツール**: **GitHub Actions**（決定）
  - 自動テスト実行（Jest、Supertest、Selenium）
  - 自動デプロイ（Vercel）
  - GitHubとの完全統合
  - 詳細な選定理由や実装方針は `consideration/cicd-tool-selection.md` を参照
  - 結合テストツールの選定理由は `consideration/integration-test-tool-selection.md` を参照

### 4.5 インフラ
- **クラウドプラットフォーム**: **Vercel**（決定）
  - **選定理由**: 費用と工数の関係から、Vercelを採用
  - フロントエンド: Vercel（Vue.jsの静的ホスティング）
  - バックエンド: Vercel Serverless Functions（Node.js + Express）
  - データベース: MongoDB Atlas（推奨）
  - 自動デプロイ: GitHub連携
  - SSL証明書: 自動発行（HTTPS対応）
  - CDN: 自動配信
  - 詳細なデプロイ手順は `consideration/vercel-deployment-guide.md` を参照

### 4.6 その他
- データ永続化: MongoDB
- UIデザイン: Figmaでデザインを作成後、実装

---

## 5. データモデル（MongoDB）

データモデルの詳細は [データモデル設計書](./data-model.md) を参照してください。

---

## 6. API設計

API設計の詳細は [API設計書](./api-design.md) を参照してください。

---

## 7. 開発フェーズ

### Phase 1: 認証機能と基本機能（最優先）
- 認証機能の実装
  - ユーザー登録・ログイン・ログアウト
  - JWT認証の実装
  - 認証ミドルウェアの実装
- 本の登録機能（2.1）
  - 外部APIとの連携（ISBN検索: openBD API → Open Library API、タイトル検索: Open Library API）
  - 書籍情報の自動取得機能
  - バーコード読み取り機能（カメラでISBNを読み取る）
- 一覧表示機能（2.7）
- 基本的なCRUD操作（2.10）

### Phase 2: 進捗管理と読了日記録
- 進捗記録機能（2.3）
  - カメラでページ数を自動認識する機能（OCR）
  - 手動入力機能
- 読了日記録機能（2.6）
- 進捗の可視化（プログレスバーなど）

### Phase 3: メモ・感想機能
- メモ・感想機能（2.4）
- メモの一覧表示・編集・削除

### Phase 4: 検索・フィルタと詳細表示
- 検索・フィルタ機能（2.8）
- 詳細表示機能（2.9）
- 複数条件の組み合わせ検索

### Phase 5: テストとCI/CDの構築
- Jestによるユニットテストの実装
- Jest + Supertest + MSWによる結合テスト・統合テストの実装
  - APIエンドポイントの統合テスト
  - データベース統合テスト
  - 外部APIモックテスト
- SeleniumによるE2Eテストの実装
- GitHub ActionsによるCI/CDパイプラインの構築
  - 自動テスト実行
  - 自動デプロイ（Vercel）

### Phase 6: UI改善とデザイン実装
- Figmaデザインの実装
- レスポンシブ対応
- ユーザビリティの向上

### Phase 7: 追加機能（任意）
- 評価機能（2.5）
- 統計・分析機能（読書量の可視化など）

### Phase 8: 将来追加予定の機能
- **CSVエクスポート・インポート機能**
  - 読書記録のCSVエクスポート
  - CSVファイルからの読書記録インポート
- **Notionデータベース連携機能**
  - Notionデータベースへの読書記録エクスポート
  - Notionデータベースからの読書記録インポート
- 詳細な実装方針は `future-features.md` を参照

---

## 8. 決定事項まとめ

### 8.1 技術スタック
- ✅ **データベース**: MongoDB（ドキュメント型NoSQL）
- ✅ **MongoDB接続ライブラリ**: Mongoose
- ✅ **フロントエンド**: Vue.js
- ✅ **状態管理**: Pinia
- ✅ **認証**: JWT（JSON Web Token）
  - 選定理由の詳細は `auth-comparison.md` を参照
- ✅ **UIフレームワーク**: Tailwind CSS
- ✅ **バーコード読み取り**: html5-qrcode
  - 詳細な選定理由や検討内容は `consideration/barcode-library-selection.md` を参照
- ✅ **外部API**: openBD API（ISBN検索・優先）、Open Library API（ISBN検索・フォールバック／タイトル検索）
  - 書籍登録機能で使用。ISBN検索は openBD → Open Library の順で検索
  - 詳細な選定理由や検討内容は `book-api-selection.md` を参照
- ✅ **インフラ**: Vercel
  - **選定理由**: 費用と工数の関係から、Vercelを採用
  - フロントエンド: Vercel（Vue.jsの静的ホスティング）
  - バックエンド: Vercel Serverless Functions（Node.js + Express）
  - データベース: MongoDB Atlas（推奨）
  - 自動デプロイ: GitHub連携
  - 詳細なデプロイ手順は `consideration/vercel-deployment-guide.md` を参照
- ✅ **OCRライブラリ**: Tesseract.js（ページ数自動認識）
  - カメラで本のページ番号を認識する機能に使用
  - 詳細な選定理由や検討内容は `consideration/ocr-library-selection.md` を参照
- ✅ **テスト・CI/CD**: Jest + Supertest + MSW + Selenium + GitHub Actions
  - 自動テスト実行
    - Jest: ユニットテスト
    - Jest + Supertest + MSW: 結合テスト・統合テスト
    - Selenium: E2Eテスト
  - 自動デプロイ（Vercel）
  - 詳細な選定理由や実装方針は `consideration/cicd-tool-selection.md` を参照
  - 結合テストツールの選定理由は `consideration/integration-test-tool-selection.md` を参照
  - 詳細な選定理由や実装方針は `cicd-tool-selection.md` を参照
- ✅ **UIデザイン**: Figmaで作成後、実装

### 8.2 優先実装機能
以下の機能を優先的に実装：
1. ✅ 本の登録機能（2.1）
2. ✅ 進捗記録機能（2.3）
3. ✅ メモ・感想機能（2.4）
4. ✅ 読了日記録機能（2.6）
5. ✅ 一覧表示機能（2.7）
6. ✅ 検索・フィルタ機能（2.8）
7. ✅ 詳細表示機能（2.9）
8. ✅ 編集・削除機能（2.10）

### 8.3 今後の検討事項

- ✅ **認証方法: JWT（JSON Web Token）**（決定）
  - **選定方針**: インターネット公開を前提とした本番環境でのスケーラビリティ、インフラコスト、可用性を重視
  - **選定理由**: セキュリティ、実装、テスト工数、本番環境での運用を総合的に比較した結果、JWTが最適と判断
  - **詳細な比較・検討内容**: `consideration/auth-comparison.md` を参照
- ✅ **Vue.jsの状態管理ライブラリ: Pinia**（決定）
- ✅ **UIフレームワーク: Tailwind CSS**（決定）
- ✅ **MongoDB接続ライブラリ: Mongoose**（決定）
- ✅ **書籍情報取得API: openBD API（優先）、Open Library API（フォールバック／タイトル検索）**（決定）
  - 書籍登録機能（2.1）で使用。ISBN検索は 1. openBD API で検索、2. 結果がなければ Open Library API で検索
  - 詳細な選定理由や検討内容は `book-api-selection.md` を参照
- **追加機能に関連する検討事項**: `future-features.md` を参照

---

## 9. データベース選定

### 9.1 選定結果

この読書管理アプリには**MongoDB（ドキュメント型NoSQL）を採用**します。

**選定理由**:
- 柔軟なスキーマで、不完全な書籍情報でも登録可能
- JavaScript/Node.jsとの親和性が高く、開発効率が良い
- リレーションの柔軟な扱いが可能
- 検索・フィルタ機能に対応可能
- 将来的なスケーラビリティに優れている

**詳細な比較・検討内容**: `consideration/database-selection.md` を参照
