# 読書管理アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
読書の進捗を管理し、読書記録を効率的に保存・閲覧できるWebアプリケーションを開発する。

### 1.2 対象ユーザー
- 読書習慣を身につけたい人
- 読んだ本を記録・管理したい人
- 読書の進捗を可視化したい人

---

## 2. 機能要件

### 2.1 本の登録機能
- **機能説明**: 読む本を登録する
- **入力方法**:
  1. **バーコード読み取り**（推奨）
     - カメラで本のバーコード（ISBN）を読み取る
     - ISBNを自動取得して書籍情報を検索
  2. **手動入力**
     - **タイトル**または**ISBN**のいずれか一方を入力（必須）
- **入力項目**（手動入力の場合）:
  - **タイトル**または**ISBN**のいずれか一方（必須）
  - ユーザーは最小限の情報のみを入力
- **自動取得項目**（WebAPIから取得）:
  - タイトル（ISBN入力時）
  - 著者名
  - ISBN（タイトル入力時、複数候補がある場合は選択可能）
  - 出版社
  - 出版日
  - 総ページ数
  - カバー画像URL
  - 説明文（任意）
- **自動記録項目**:
  - 登録日時
- **使用する外部API**: **Open Library API**
  - タイトルまたはISBNを入力すると、Open Library APIから書籍情報を自動取得
  - 詳細なAPI選定理由や検討内容は `consideration/book-api-selection.md` を参照
- **バーコード読み取り機能**:
  - カメラアクセスの許可をユーザーに要求
  - リアルタイムでバーコードをスキャン
  - ISBN-10、ISBN-13の両方に対応
  - 読み取り成功時に自動で書籍情報を検索
  - 読み取り失敗時は再試行または手動入力に切り替え可能
- **詳細**:
  - 取得した情報はユーザーが確認・編集可能
  - 複数の候補がある場合は、ユーザーが選択できる
  - APIから情報が取得できない場合は、手動入力フォームを表示

### 2.2 読書状況管理機能
- **機能説明**: 本の読書状況を管理する
- **状態**:
  - 未読（未着手）
  - 読書中（現在読んでいる）
  - 読了（読み終わった）
  - 中断（途中でやめた）
- **詳細**:
  - 状態の変更が可能
  - 状態変更日時を記録

### 2.3 進捗記録機能
- **機能説明**: 読書の進捗を記録する
- **入力方法**:
  1. **カメラでページ数自動認識**（推奨）
     - カメラで本のページ番号を撮影
     - OCR（光学文字認識）でページ数を自動認識
     - 認識したページ数を自動入力
  2. **手動入力**
     - ページ数を数値で直接入力
- **詳細**:
  - 現在のページ数（読書中の本のみ）
  - 進捗率（%）（総ページ数がある場合、自動計算）
  - 進捗更新日時
  - 進捗履歴の記録（任意）
- **ページ数自動認識機能**:
  - カメラアクセスの許可をユーザーに要求
  - 本のページ番号部分を撮影
  - OCRでページ番号を認識
  - 認識結果をユーザーが確認・修正可能
  - 認識失敗時は再撮影または手動入力に切り替え可能

### 2.4 メモ・感想機能
- **機能説明**: 本に関するメモや感想を記録する
- **詳細**:
  - メモ本文（複数行テキスト）
  - 作成日時（自動記録）
  - 更新日時（自動記録）
  - 1冊の本に複数のメモを追加可能

### 2.5 評価機能
- **機能説明**: 読んだ本を評価する
- **詳細**:
  - 星評価（1〜5段階、0.5刻み）
  - 評価日時（自動記録）
  - 評価コメント（任意）

### 2.6 読了日記録機能
- **機能説明**: 本を読み終えた日を記録する
- **詳細**:
  - 読了日（日付選択）
  - 状態を「読了」に変更した際に自動記録（任意）

### 2.7 一覧表示機能
- **機能説明**: 登録した本の一覧を表示する
- **詳細**:
  - リスト形式で表示
  - 各本の基本情報（タイトル、著者、状態、進捗）を表示
  - ページネーション対応（任意）

### 2.8 検索・フィルタ機能
- **機能説明**: 登録した本を検索・絞り込む
- **詳細**:
  - タイトル・著者名での検索
  - 読書状況でのフィルタ（未読/読書中/読了/中断）
  - 評価でのフィルタ（3以上、4以上など）
  - 複数条件の組み合わせ検索

### 2.9 詳細表示機能
- **機能説明**: 1冊の本の詳細情報を表示する
- **詳細**:
  - 基本情報の表示
  - 進捗情報の表示
  - メモ・感想の一覧表示
  - 評価の表示
  - 編集・削除機能へのリンク

### 2.10 編集・削除機能
- **機能説明**: 登録した本の情報を編集・削除する
- **詳細**:
  - 基本情報の編集
  - 本の削除（確認ダイアログ付き）

### 2.11 認証機能（必須）
- **機能説明**: 複数ユーザーに対応するための認証機能
- **詳細**:
  - ユーザー登録（サインアップ）
    - ユーザー名（必須）
    - メールアドレス（必須、一意）
    - パスワード（必須、ハッシュ化して保存）
  - ログイン（サインイン）
    - メールアドレスとパスワードで認証
    - セッション管理（JWT推奨）
  - ログアウト
  - パスワードリセット（任意、Phase 2以降）
  - 認証状態の維持（リフレッシュトークンなど）
- **セキュリティ要件**:
  - パスワードはbcryptなどでハッシュ化
  - JWTトークンの有効期限管理
  - 認証が必要なAPIエンドポイントの保護

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 一覧表示のレスポンス時間: 1秒以内
- データベース操作の最適化

### 3.2 セキュリティ
- 入力値のバリデーション
- XSS対策
- NoSQLインジェクション対策（MongoDB使用時）
- 認証・認可の実装
- パスワードのハッシュ化（bcrypt推奨）
- HTTPS通信（本番環境）
- CORS設定の適切な管理

### 3.3 ユーザビリティ
- 直感的なUI/UX
- レスポンシブデザイン（モバイル対応）
- エラーメッセージの明確化

### 3.4 保守性
- コードの可読性
- 適切なコメント
- モジュール化

### 3.5 テスト
- **自動テスト**: 
  - Jest（ユニットテスト）
  - Jest + Supertest + MSW（結合テスト・統合テスト）
  - Selenium（E2Eテスト）
- **テストカバレッジ**: 70%以上を目標
- **CI/CD**: GitHub Actionsを使用して自動テストとデプロイを実現
- 詳細なテスト計画とCI/CDツールの選定理由は `consideration/cicd-tool-selection.md` を参照
- 結合テストツールの選定理由は `consideration/integration-test-tool-selection.md` を参照

---

## 4. 技術スタック

### 4.1 バックエンド
- Node.js + Express（既存）
- データベース: **MongoDB**（決定）
- **MongoDB接続ライブラリ: Mongoose**（決定）
  - **RDB vs KVSの選定理由**:
    - このアプリには**MongoDB（ドキュメント型NoSQL）が適している**
    - 理由:
      1. **柔軟なスキーマ**: 本の情報が不完全でも登録可能（総ページ数やISBNがなくてもOK）
      2. **リレーションの柔軟な扱い**: 本とメモ、進捗履歴の関係を埋め込みまたは参照で柔軟に設計可能
      3. **検索・フィルタ機能**: MongoDBのクエリ機能で複雑な検索条件に対応可能
      4. **スケーラビリティ**: 将来的にユーザー数が増えても対応しやすい
      5. **JSON形式**: JavaScript/Node.jsとの親和性が高い
    - RDB（PostgreSQL/MySQL）との比較:
      - RDBも適しているが、MongoDBの方が柔軟性と開発速度の面で有利
      - 複雑な集計やトランザクションが必要になった場合はRDBを検討
- 認証: **JWT（JSON Web Token）**（決定）
  - **選定方針**: インターネット公開を前提とした本番環境でのスケーラビリティ、インフラコスト、可用性を重視し、JWTを採用
  - **選定理由**: セキュリティ、実装、テスト工数、本番環境での運用を総合的に比較した結果、JWTが最適と判断
  - **詳細な比較・検討内容**: `consideration/auth-comparison.md` を参照

### 4.2 フロントエンド
- **Vue.js**（決定）
- Vue Router（ルーティング）
- **状態管理: Pinia**（決定）
- **UIフレームワーク: Tailwind CSS**（決定）
- **バーコード読み取りライブラリ**: **html5-qrcode**（決定）
  - カメラで本のバーコード（ISBN）を読み取る機能に使用
  - 詳細な選定理由や検討内容は `consideration/barcode-library-selection.md` を参照
- **OCRライブラリ**: **Tesseract.js**（決定）
  - カメラで本のページ番号を認識する機能に使用
  - 詳細な選定理由や検討内容は `consideration/ocr-library-selection.md` を参照

### 4.3 外部API
- **書籍情報取得API**: **Open Library API**（決定）
  - 書籍登録機能（2.1）で使用
  - タイトルまたはISBNから書籍情報を自動取得
  - 詳細なAPI選定理由や検討内容は `consideration/book-api-selection.md` を参照

### 4.4 テスト・CI/CD
- **テストフレームワーク**: 
  - **Jest**（ユニットテスト）
  - **Jest + Supertest + MSW**（結合テスト・統合テスト、決定）
  - **Selenium**（E2Eテスト）
- **CI/CDツール**: **GitHub Actions**（決定）
  - 自動テスト実行（Jest、Supertest、Selenium）
  - 自動デプロイ（Vercel）
  - GitHubとの完全統合
  - 詳細な選定理由や実装方針は `consideration/cicd-tool-selection.md` を参照
  - 結合テストツールの選定理由は `consideration/integration-test-tool-selection.md` を参照

### 4.5 インフラ
- **クラウドプラットフォーム**: **Vercel**（決定）
  - **選定理由**: 費用と工数の関係から、Vercelを採用
  - フロントエンド: Vercel（Vue.jsの静的ホスティング）
  - バックエンド: Vercel Serverless Functions（Node.js + Express）
  - データベース: MongoDB Atlas（推奨）
  - 自動デプロイ: GitHub連携
  - SSL証明書: 自動発行（HTTPS対応）
  - CDN: 自動配信
  - 詳細なデプロイ手順は `consideration/vercel-deployment-guide.md` を参照

### 4.6 その他
- データ永続化: MongoDB
- UIデザイン: Figmaでデザインを作成後、実装

---

## 5. データモデル（MongoDB）

### 5.1 ユーザー（User）
```javascript
{
  _id: ObjectId,
  username: String (必須, 一意),
  email: String (必須, 一意, インデックス),
  password: String (必須, ハッシュ化),
  createdAt: Date,
  updatedAt: Date
}
```

### 5.2 本（Book）
```javascript
{
  _id: ObjectId,
  userId: ObjectId (必須, Userへの参照, インデックス),
  title: String (必須, APIから取得または手動入力),
  author: String (任意, APIから取得または手動入力),
  isbn: String (任意, APIから取得または手動入力),
  publisher: String (任意, APIから取得),
  publishDate: String (任意, APIから取得),
  totalPages: Number (任意, APIから取得),
  currentPage: Number (任意, デフォルト: 0),
  status: String (必須, enum: ['未読', '読書中', '読了', '中断'], デフォルト: '未読'),
  rating: Number (任意, 0.5-5.0, 0.5刻み),
  coverImageUrl: String (任意, APIから取得),
  description: String (任意, APIから取得),
  createdAt: Date,
  updatedAt: Date
}
```

### 5.3 メモ（Note）
```javascript
{
  _id: ObjectId,
  userId: ObjectId (必須, Userへの参照, インデックス),
  bookId: ObjectId (必須, Bookへの参照, インデックス),
  content: String (必須),
  createdAt: Date,
  updatedAt: Date
}
```

### 5.4 進捗履歴（ProgressHistory）（任意）
```javascript
{
  _id: ObjectId,
  userId: ObjectId (必須, Userへの参照, インデックス),
  bookId: ObjectId (必須, Bookへの参照, インデックス),
  page: Number (必須),
  progress: Number (必須, 0-100, %),
  recordedAt: Date (必須)
}
```

### 5.5 インデックス設計
- User: `email` (ユニークインデックス)
- Book: `userId`, `userId + status`, `userId + title` (複合インデックス)
- Note: `userId`, `bookId`, `userId + bookId` (複合インデックス)
- ProgressHistory: `userId`, `bookId`, `userId + bookId` (複合インデックス)

---

## 6. API設計

### 6.1 認証
- `POST /api/auth/register` - ユーザー登録
- `POST /api/auth/login` - ログイン
- `POST /api/auth/logout` - ログアウト
- `GET /api/auth/me` - 現在のユーザー情報取得
- `POST /api/auth/refresh` - トークンリフレッシュ（任意）

### 6.2 書籍情報検索（認証必須）
- `GET /api/books/search?q=タイトルまたはISBN` - 外部APIから書籍情報を検索
  - タイトルまたはISBNで検索
  - 複数の候補を返す（ユーザーが選択可能）
  - レスポンス: 書籍情報の配列

### 6.3 本の管理（認証必須）
- `GET /api/books` - 本の一覧取得（自分の本のみ）
- `GET /api/books/:id` - 本の詳細取得（自分の本のみ）
- `POST /api/books` - 本の登録（書籍情報を含む）
- `PUT /api/books/:id` - 本の更新（自分の本のみ）
- `DELETE /api/books/:id` - 本の削除（自分の本のみ）

### 6.4 検索・フィルタ（認証必須）
- `GET /api/books?search=キーワード` - タイトル・著者名で検索
- `GET /api/books?status=読書中` - 読書状況でフィルタ
- `GET /api/books?rating=4` - 評価でフィルタ（4以上など）
- `GET /api/books?search=キーワード&status=読書中&rating=4` - 複数条件の組み合わせ

### 6.5 メモ管理（認証必須）
- `GET /api/books/:id/notes` - メモ一覧取得（自分の本のメモのみ）
- `POST /api/books/:id/notes` - メモ追加
- `PUT /api/notes/:id` - メモ更新（自分のメモのみ）
- `DELETE /api/notes/:id` - メモ削除（自分のメモのみ）

### 6.6 進捗管理（認証必須）
- `PUT /api/books/:id/progress` - 進捗更新（ページ数、進捗率）
- `GET /api/books/:id/progress-history` - 進捗履歴取得（任意）

---

## 7. 開発フェーズ

### Phase 1: 認証機能と基本機能（最優先）
- 認証機能の実装
  - ユーザー登録・ログイン・ログアウト
  - JWT認証の実装
  - 認証ミドルウェアの実装
- 本の登録機能（2.1）
  - 外部API（Open Library API）との連携
  - 書籍情報の自動取得機能
  - バーコード読み取り機能（カメラでISBNを読み取る）
- 一覧表示機能（2.7）
- 基本的なCRUD操作（2.10）

### Phase 2: 進捗管理と読了日記録
- 進捗記録機能（2.3）
  - カメラでページ数を自動認識する機能（OCR）
  - 手動入力機能
- 読了日記録機能（2.6）
- 進捗の可視化（プログレスバーなど）

### Phase 3: メモ・感想機能
- メモ・感想機能（2.4）
- メモの一覧表示・編集・削除

### Phase 4: 検索・フィルタと詳細表示
- 検索・フィルタ機能（2.8）
- 詳細表示機能（2.9）
- 複数条件の組み合わせ検索

### Phase 5: テストとCI/CDの構築
- Jestによるユニットテストの実装
- Jest + Supertest + MSWによる結合テスト・統合テストの実装
  - APIエンドポイントの統合テスト
  - データベース統合テスト
  - 外部APIモックテスト
- SeleniumによるE2Eテストの実装
- GitHub ActionsによるCI/CDパイプラインの構築
  - 自動テスト実行
  - 自動デプロイ（Vercel）

### Phase 6: UI改善とデザイン実装
- Figmaデザインの実装
- レスポンシブ対応
- ユーザビリティの向上

### Phase 7: 追加機能（任意）
- 評価機能（2.5）
- 統計・分析機能（読書量の可視化など）

### Phase 8: 将来追加予定の機能
- **CSVエクスポート・インポート機能**
  - 読書記録のCSVエクスポート
  - CSVファイルからの読書記録インポート
- **Notionデータベース連携機能**
  - Notionデータベースへの読書記録エクスポート
  - Notionデータベースからの読書記録インポート
- 詳細な実装方針は `future-features.md` を参照

---

## 8. 決定事項まとめ

### 8.1 技術スタック
- ✅ **データベース**: MongoDB（ドキュメント型NoSQL）
- ✅ **MongoDB接続ライブラリ**: Mongoose
- ✅ **フロントエンド**: Vue.js
- ✅ **状態管理**: Pinia
- ✅ **認証**: JWT（JSON Web Token）
  - 選定理由の詳細は `auth-comparison.md` を参照
- ✅ **UIフレームワーク**: Tailwind CSS
- ✅ **バーコード読み取り**: html5-qrcode
  - 詳細な選定理由や検討内容は `consideration/barcode-library-selection.md` を参照
- ✅ **外部API**: Open Library API（書籍情報取得）
  - 書籍登録機能で使用
  - 詳細な選定理由や検討内容は `book-api-selection.md` を参照
- ✅ **インフラ**: Vercel
  - **選定理由**: 費用と工数の関係から、Vercelを採用
  - フロントエンド: Vercel（Vue.jsの静的ホスティング）
  - バックエンド: Vercel Serverless Functions（Node.js + Express）
  - データベース: MongoDB Atlas（推奨）
  - 自動デプロイ: GitHub連携
  - 詳細なデプロイ手順は `consideration/vercel-deployment-guide.md` を参照
- ✅ **OCRライブラリ**: Tesseract.js（ページ数自動認識）
  - カメラで本のページ番号を認識する機能に使用
  - 詳細な選定理由や検討内容は `consideration/ocr-library-selection.md` を参照
- ✅ **テスト・CI/CD**: Jest + Supertest + MSW + Selenium + GitHub Actions
  - 自動テスト実行
    - Jest: ユニットテスト
    - Jest + Supertest + MSW: 結合テスト・統合テスト
    - Selenium: E2Eテスト
  - 自動デプロイ（Vercel）
  - 詳細な選定理由や実装方針は `consideration/cicd-tool-selection.md` を参照
  - 結合テストツールの選定理由は `consideration/integration-test-tool-selection.md` を参照
  - 詳細な選定理由や実装方針は `cicd-tool-selection.md` を参照
- ✅ **UIデザイン**: Figmaで作成後、実装

### 8.2 優先実装機能
以下の機能を優先的に実装：
1. ✅ 本の登録機能（2.1）
2. ✅ 進捗記録機能（2.3）
3. ✅ メモ・感想機能（2.4）
4. ✅ 読了日記録機能（2.6）
5. ✅ 一覧表示機能（2.7）
6. ✅ 検索・フィルタ機能（2.8）
7. ✅ 詳細表示機能（2.9）
8. ✅ 編集・削除機能（2.10）

### 8.3 今後の検討事項

- ✅ **認証方法: JWT（JSON Web Token）**（決定）
  - **選定方針**: インターネット公開を前提とした本番環境でのスケーラビリティ、インフラコスト、可用性を重視
  - **選定理由**: セキュリティ、実装、テスト工数、本番環境での運用を総合的に比較した結果、JWTが最適と判断
  - **詳細な比較・検討内容**: `consideration/auth-comparison.md` を参照
- ✅ **Vue.jsの状態管理ライブラリ: Pinia**（決定）
- ✅ **UIフレームワーク: Tailwind CSS**（決定）
- ✅ **MongoDB接続ライブラリ: Mongoose**（決定）
- ✅ **書籍情報取得API: Open Library API**（決定）
  - 書籍登録機能（2.1）で使用
  - 詳細な選定理由や検討内容は `book-api-selection.md` を参照
- **追加機能に関連する検討事項**: `future-features.md` を参照

---

## 9. データベース選定の詳細説明

### 9.1 MongoDB（ドキュメント型NoSQL）が適している理由

この読書管理アプリには**MongoDBが適している**と判断しました。理由は以下の通りです：

#### ✅ MongoDBのメリット
1. **柔軟なスキーマ**
   - 本の情報が不完全でも登録可能（総ページ数やISBNがなくてもOK）
   - 後からフィールドを追加しやすい

2. **JavaScript/Node.jsとの親和性**
   - JSON形式でデータを保存するため、JavaScriptオブジェクトと直接対応
   - データ変換が不要で開発効率が高い

3. **リレーションの柔軟な扱い**
   - 本とメモの関係を埋め込み（Embedded）または参照（Reference）で柔軟に設計可能
   - ユースケースに応じて最適な設計を選択できる

4. **検索・フィルタ機能**
   - MongoDBのクエリ機能で複雑な検索条件に対応可能
   - インデックスを適切に設定すれば高速な検索が可能

5. **スケーラビリティ**
   - 将来的にユーザー数が増えても対応しやすい
   - 水平スケーリングが容易

#### ⚠️ RDB（PostgreSQL/MySQL）との比較

**RDBも適しているが、このアプリにはMongoDBが有利な理由：**

- **柔軟性**: 本の情報が不完全でも登録できる点が重要
- **開発速度**: JSON形式で扱えるため、開発が速い
- **複雑な集計が少ない**: 現時点では複雑な集計クエリは想定していない
- **トランザクション**: このアプリでは複数テーブルにまたがる厳密なトランザクションは不要

**RDBを選ぶべき場合：**
- 複雑な集計・分析が必要になった場合
- 厳密なトランザクション管理が必要になった場合
- 既存のRDBスキルを活用したい場合

---

## 10. 次のステップ

1. **プロジェクト構造の設計**
   - バックエンド（Express）とフロントエンド（Vue.js）の分離
   - ディレクトリ構造の決定

2. **開発環境のセットアップ**
   - MongoDBのインストール・設定
   - Vue.jsプロジェクトの初期化
   - 必要なパッケージのインストール

3. **Figmaデザインの作成**
   - UIデザインの作成
   - デザインシステムの定義

4. **Phase 1の実装開始**
   - 認証機能の実装
   - 本の登録・一覧表示機能の実装
